
# Command to check for vulnerabilities
docker run --rm -v $PWD:/opt ghcr.io/praetorian-inc/noseyparkernoseyparker scan -vvv --datastore /opt /opt --color always --progress always

# Use the c5ad.24xlarge instance type

# Format new disks and mount
sudo mkfs -t xfs /dev/nvme1n1
sudo mkfs -t xfs /dev/nvme2n1

mkdir /data1 /data2
sudo mount /dev/nvme1n1 /data1
sudo mount /dev/nvme2n1 /data2

chmod -R 777 /data1
chmod -R 777 /data2s

EC2_storage1=/data1
EC2_storage2=/data2

# Copy all relevant files and folders to EC2 storage
mkdir -p ${EC2_storage1}/ABRIDGE
cp -r /home/baners23/work/ABRIDGE/testing/reference ${EC2_storage1}/ABRIDGE/testing/

########################################################################################################################
# CWL commands for RNA-Seq
cwltool \
--outdir ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_1 \
--cachedir ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_cache \
/home/baners23/work/ABRIDGE/Abridge_analysis_and_manuscript/cwl_scripts/workflows/rna_seq_download_align_pe_se.cwl \
--threads 96 \
--SRA_accession SRR23242149 \
--genomeFastaFiles ${EC2_storage1}/ABRIDGE/testing/reference/Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa \
--chromosome 1 \
1> ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_1.output \
2> ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_1.error

cwltool \
--outdir ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_all \
--cachedir ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_cache \
/home/baners23/work/ABRIDGE/Abridge_analysis_and_manuscript/cwl_scripts/workflows/rna_seq_download_align_pe_se.cwl \
--threads 96 \
--SRA_accession SRR23242149 \
--genomeFastaFiles ${EC2_storage1}/ABRIDGE/testing/reference/Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa \
1> ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_all.output \
2> ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_all.error
########################################################################################################################


########################################################################################################################
# CWL commands for DNA-Seq
cwltool \
--outdir ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_chromosome_1 \
--cachedir ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_cache \
/home/baners23/work/ABRIDGE/Abridge_analysis_and_manuscript/cwl_scripts/workflows/dna_seq_download_align_pe_se.cwl \
--threads 96 \
--SRA_accession SRR23351483 \
--reference ${EC2_storage1}/ABRIDGE/testing/reference/Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa \
--chromosome 1 \
1> ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_chromosome_1.output \
2> ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_chromosome_1.error

cwltool \
--outdir ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_chromosome_all \
--cachedir ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_cache \
/home/baners23/work/ABRIDGE/Abridge_analysis_and_manuscript/cwl_scripts/workflows/dna_seq_download_align_pe_se.cwl \
--threads 96 \
--SRA_accession SRR23351483 \
--reference ${EC2_storage1}/ABRIDGE/testing/reference/Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa \
1> ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_chromosome_all.output \
2> ${EC2_storage1}/ABRIDGE/testing/alignments/dna_seq_chromosome_all.error
########################################################################################################################

rm -rf \
${EC2_storage1}/ABRIDGE/testing/abrigde/SRR23242149_SE_all_tags_sorted_1_dev_temp  \
${EC2_storage1}/ABRIDGE/testing/abrigde/SRR23242149_SE_all_tags_sorted_1_dev.abridge && \
abridge \
--compress \
--reference ${EC2_storage1}/ABRIDGE/testing/reference/Homo_sapiens.GRCh38.dna_sm.primary_assembly.fa \
--outputfilename ${EC2_storage1}/ABRIDGE/testing/abrigde/SRR23242149_SE_all_tags_sorted_1_dev.abridge \
--inputalignedfilename ${EC2_storage1}/ABRIDGE/testing/alignments/rna_seq_chromosome_1/SRR23242149_SE_all_tags_sorted_1.sam \
--temp_directory ${EC2_storage1}/ABRIDGE/testing/abrigde/SRR23242149_SE_all_tags_sorted_1_dev_temp \
1> ${EC2_storage1}/ABRIDGE/testing/abrigde/SRR23242149_SE_all_tags_sorted_1_dev.output \
2> ${EC2_storage1}/ABRIDGE/testing/abrigde/SRR23242149_SE_all_tags_sorted_1_dev.error





